  Root Cause Analysis: Character Spacing Bug in PDF Export
                                                                                                                                                                                                 
  The Problem     

  Certain lines in the exported PDF have spaces between every character (e.g., B r i t s  n a v i g a t e) while other lines render normally.

  Root Cause: Unicode Characters + WinAnsiEncoding Mismatch

  The bug is caused by the interaction between Unicode characters in the analytics text (generated by Barbara/GPT) and jsPDF's standard Helvetica font (which uses WinAnsiEncoding).

  Here's the chain of events:

  1. Barbara generates analytics text containing Unicode characters outside WinAnsiEncoding

  GPT models commonly output characters like:
  - Minus sign (−, U+2212) instead of hyphen (-, U+002D)
  - Non-breaking hyphen (U+2011)
  - Zero-width spaces (U+200B/U+200C)
  - fi/fl ligatures (U+FB01/U+FB02)
  - Thin/hair spaces, en-spaces (U+2002, U+2009)

  Note: many Unicode chars like em-dash (—), smart quotes (" "), and bullets (•) ARE in WinAnsiEncoding and are fine. It's the rarer ones that cause the problem.

  2. jsPDF's pdfEscape → to8bitStream converts the ENTIRE string to UCS-2 BE

  In jspdf.es.js:3053-3064, when ANY character in the text has a charCode > 255 that can't be mapped to WinAnsiEncoding, the entire string gets re-encoded as UCS-2 Big Endian (2 bytes per
  character):

  // Line 3055-3058: If any char > 255, isUnicode = true
  while (isUnicode === undefined && i !== 0) {
    if (text.charCodeAt(i - 1) >> 8) { isUnicode = true; }
    i--;
  }
  // Line 3065-3076: Entire string → UCS-2 BE (2 bytes per char)
  newtext = flags.noBOM ? [] : [254, 255];
  for (i = 0, l = text.length; i < l; i++) {
    ch = text.charCodeAt(i);
    bch = ch >> 8;
    newtext.push(bch);       // high byte (0x00 for ASCII)
    newtext.push(ch - (bch << 8)); // low byte
  }

  3. PDF viewer interprets UCS-2 bytes using WinAnsiEncoding

  Since the font is set to WinAnsiEncoding (not Identity-H), the PDF viewer reads each byte individually:
  - For ASCII 'B' (charCode 66): byte 0x00 → .notdef glyph (rendered as space), byte 0x42 → 'B'
  - Result: every character has a null-glyph gap before it → B r i t s

  Why the Pattern is Selective

  - splitTextToSize wraps text into separate lines — each line is rendered via an independent pdf.text() call
  - Only lines containing the offending Unicode character get UCS-2 encoded
  - The last (shorter) wrapped line may not contain the character, rendering normally
  - Bullet points with only ASCII + common WinAnsi Unicode (like em-dash) render fine

  Confirmation from jsPDF Issues

  This is a documented pattern: https://github.com/parallax/jsPDF/issues/1868 — "I observe this behavior if there are utf8 characters in the line. The character '→' breaks everything and after
  this character everything looks like '→ t h i s w i t h e x t r a s p a c e s'."

  Recommended Fixes (in order of reliability)

  Option A — Text sanitization (simplest): Add a sanitizer function in the PdfBuilder that strips/replaces non-WinAnsiEncoding characters before any pdf.text() or splitTextToSize() call.

  Option B — Embed a Unicode font: Use pdf.addFont() with a TTF file (e.g., Inter, Noto Sans) that uses Identity-H encoding, which natively handles all Unicode.

  Option C — Both: Sanitize as a safety net AND embed a proper font for correct rendering.

  Key Sources

  - https://github.com/parallax/jsPDF/issues/1868
  - https://github.com/parallax/jsPDF/issues/3705
  - https://github.com/parallax/jsPDF/issues/3301
  - https://github.com/parallax/jsPDF/issues/2647

  Want me to implement a fix? Option A (text sanitization) would be the faste