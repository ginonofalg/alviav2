  This document provides comprehensive instructions for building a test harness that populates Alvia's database with realistic interview data for testing analytics at           
  Collection, Template, and Project levels.                                                                                                                                      
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 1. Overview                                                                                                                                                                 
                                                                                                                                                                                 
  Create a TypeScript script that:                                                                                                                                               
  1. Uses OpenAI's API to generate realistic interview conversations                                                                                                             
  2. Populates the PostgreSQL database with simulated interview data                                                                                                             
  3. Creates the full data hierarchy: Workspace → Project → Template → Questions → Collection → Respondents → Sessions → Segments                                                
                                                                                                                                                                                 
  **Why TypeScript (not pure SQL):**                                                                                                                                             
  - Needs LLM integration for realistic content generation                                                                                                                       
  - Complex JSONB structures are easier to construct programmatically                                                                                                            
  - Can leverage existing Drizzle ORM types for type safety                                                                                                                      
  - Reuses the existing `DatabaseStorage` class                                                                                                                                  
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 2. File Structure                                                                                                                                                           
                                                                                                                                                                                 
  Create the following directory structure:                                                                                                                                      
                                                                                                                                                                                 
  ```                                                                                                                                                                            
  scripts/                                                                                                                                                                       
  seed-test-data/                                                                                                                                                                
  index.ts              # Main entry point with CLI                                                                                                                              
  config.ts             # Configuration constants                                                                                                                                
  scenarios.ts          # Interview scenario definitions                                                                                                                         
  generators/                                                                                                                                                                    
  structure.ts        # Creates workspace, project, template, questions, collection                                                                                              
  personas.ts         # LLM-generated respondent personas                                                                                                                        
  conversations.ts    # LLM-powered interview conversation simulation                                                                                                            
  summaries.ts        # Question summaries, verbatims, and quality metrics                                                                                                       
  utils/                                                                                                                                                                         
  timestamps.ts       # Realistic timestamp generation                                                                                                                           
  openai.ts           # OpenAI API wrapper                                                                                                                                       
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 3. Configuration (config.ts)                                                                                                                                                
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/config.ts                                                                                                                                            
                                                                                                                                                                                 
  export const SEED_CONFIG = {                                                                                                                                                   
  // LLM settings                                                                                                                                                                
  model: "gpt-4o-mini",  // Cost-effective for generation                                                                                                                        
                                                                                                                                                                                 
  // Volume settings                                                                                                                                                             
  respondentsPerCollection: 18,  // 15-20 range                                                                                                                                  
  questionsPerTemplate: 6,       // 5-7 questions per template                                                                                                                   
                                                                                                                                                                                 
  // Quality distribution (must sum to 1.0)                                                                                                                                      
  qualityDistribution: {                                                                                                                                                         
  high_quality: 0.45,   // 45% give excellent, detailed responses                                                                                                                
  moderate: 0.30,       // 30% average quality                                                                                                                                   
  brief: 0.15,          // 15% short responses, need probing                                                                                                                     
  off_topic: 0.10       // 10% tend to go off-topic                                                                                                                              
  },                                                                                                                                                                             
                                                                                                                                                                                 
  // Response characteristics by quality                                                                                                                                         
  responseCharacteristics: {                                                                                                                                                     
  high_quality: { minWords: 100, maxWords: 300, followUpDepth: 3 },                                                                                                              
  moderate: { minWords: 50, maxWords: 150, followUpDepth: 2 },                                                                                                                   
  brief: { minWords: 15, maxWords: 50, followUpDepth: 1 },                                                                                                                       
  off_topic: { minWords: 80, maxWords: 200, followUpDepth: 2 }                                                                                                                   
  },                                                                                                                                                                             
                                                                                                                                                                                 
  // Sentiment distribution for variety                                                                                                                                          
  sentimentDistribution: {                                                                                                                                                       
  positive: 0.45,                                                                                                                                                                
  neutral: 0.30,                                                                                                                                                                 
  negative: 0.20,                                                                                                                                                                
  mixed: 0.05                                                                                                                                                                    
  },                                                                                                                                                                             
                                                                                                                                                                                 
  // Analytics - leave null to test refresh flow                                                                                                                                 
  preComputeAnalytics: false                                                                                                                                                     
  };                                                                                                                                                                             
                                                                                                                                                                                 
  export type QualityTendency = keyof typeof SEED_CONFIG.qualityDistribution;                                                                                                    
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 4. Interview Scenarios (scenarios.ts)                                                                                                                                       
                                                                                                                                                                                 
  Define 2 research scenarios with complete question sets:                                                                                                                       
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/scenarios.ts                                                                                                                                         
                                                                                                                                                                                 
  import type { QualityTendency } from './config';                                                                                                                               
                                                                                                                                                                                 
  export type QuestionType = "open" | "yes_no" | "scale" | "numeric" | "multi_select";                                                                                           
                                                                                                                                                                                 
  export interface ScenarioQuestion {                                                                                                                                            
  text: string;                                                                                                                                                                  
  type: QuestionType;                                                                                                                                                            
  guidance: string;                                                                                                                                                              
  scaleMin?: number;                                                                                                                                                             
  scaleMax?: number;                                                                                                                                                             
  multiSelectOptions?: string[];                                                                                                                                                 
  timeHintSeconds?: number;                                                                                                                                                      
  recommendedFollowUps?: number;                                                                                                                                                 
  }                                                                                                                                                                              
                                                                                                                                                                                 
  export interface Scenario {                                                                                                                                                    
  name: string;                                                                                                                                                                  
  projectName: string;                                                                                                                                                           
  templateName: string;                                                                                                                                                          
  collectionName: string;                                                                                                                                                        
  objective: string;                                                                                                                                                             
  audienceContext: string;                                                                                                                                                       
  strategicContext: string;                                                                                                                                                      
  contextType: "product" | "cx" | "content" | "marketing" | "other";                                                                                                             
  tone: string;                                                                                                                                                                  
  questions: ScenarioQuestion[];                                                                                                                                                 
  }                                                                                                                                                                              
                                                                                                                                                                                 
  export const SCENARIOS: Scenario[] = [                                                                                                                                         
  {                                                                                                                                                                              
  name: "Product Discovery Research",                                                                                                                                            
  projectName: "Product Discovery Study Q1 2024",                                                                                                                                
  templateName: "Product Discovery Interview v1",                                                                                                                                
  collectionName: "January 2024 Product Discovery",                                                                                                                              
  objective: "Understand how users discover, evaluate, and adopt new software tools for their work",                                                                             
  audienceContext: "B2B SaaS professionals at companies with 50-500 employees who evaluate productivity and collaboration tools",                                                
  strategicContext: "We are planning to launch a new AI-powered productivity tool and need to understand the competitive landscape and user decision-making process",            
  contextType: "product",                                                                                                                                                        
  tone: "conversational",                                                                                                                                                        
  questions: [                                                                                                                                                                   
  {                                                                                                                                                                              
  text: "How do you typically discover new tools for your work?",                                                                                                                
  type: "open",                                                                                                                                                                  
  guidance: "Probe for specific channels: word of mouth, social media, review sites, search, conferences. Ask for recent examples.",                                             
  timeHintSeconds: 120,                                                                                                                                                          
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "Think about the last software tool you adopted at work. What made you decide to try it?",                                                                               
  type: "open",                                                                                                                                                                  
  guidance: "Explore the trigger event, pain point, or opportunity that led to the search. Get specific details about the situation.",                                           
  timeHintSeconds: 150,                                                                                                                                                          
  recommendedFollowUps: 3                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "On a scale of 1 to 10, how satisfied are you with your current workflow tools?",                                                                                        
  type: "scale",                                                                                                                                                                 
  scaleMin: 1,                                                                                                                                                                   
  scaleMax: 10,                                                                                                                                                                  
  guidance: "After they give a number, always ask what would need to change to move it higher. Explore specific pain points.",                                                   
  timeHintSeconds: 90,                                                                                                                                                           
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "What's the most frustrating part of evaluating new software?",                                                                                                          
  type: "open",                                                                                                                                                                  
  guidance: "Listen for: time constraints, too many options, unclear pricing, lack of trials, integration concerns, approval processes.",                                        
  timeHintSeconds: 120,                                                                                                                                                          
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "Have you ever recommended a software tool to a colleague? What made you recommend it?",                                                                                 
  type: "yes_no",                                                                                                                                                                
  guidance: "If yes, explore what drove the recommendation. If no, ask what would make them likely to recommend something.",                                                     
  timeHintSeconds: 90,                                                                                                                                                           
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "If you could wave a magic wand and improve one thing about how you work today, what would it be?",                                                                      
  type: "open",                                                                                                                                                                  
  guidance: "This is the closing aspirational question. Let them dream big, then probe for the underlying need.",                                                                
  timeHintSeconds: 120,                                                                                                                                                          
  recommendedFollowUps: 1                                                                                                                                                        
  }                                                                                                                                                                              
  ]                                                                                                                                                                              
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  name: "Customer Experience Feedback",                                                                                                                                          
  projectName: "Customer Support Experience Study",                                                                                                                              
  templateName: "Support Experience Interview v1",                                                                                                                               
  collectionName: "January 2024 Support Feedback",                                                                                                                               
  objective: "Gather insights on customer support experiences to identify improvement opportunities and measure satisfaction drivers",                                           
  audienceContext: "Customers who have contacted support in the last 30 days across all support channels (chat, email, phone)",                                                  
  strategicContext: "We are redesigning our support experience and need to understand what matters most to customers when they need help",                                       
  contextType: "cx",                                                                                                                                                             
  tone: "empathetic",                                                                                                                                                            
  questions: [                                                                                                                                                                   
  {                                                                                                                                                                              
  text: "Tell me about your most recent experience contacting our support team.",                                                                                                
  type: "open",                                                                                                                                                                  
  guidance: "Get the full story: what was the issue, which channel did they use, how was it resolved. Show empathy.",                                                            
  timeHintSeconds: 180,                                                                                                                                                          
  recommendedFollowUps: 3                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "How would you rate the overall support experience on a scale of 1 to 10?",                                                                                              
  type: "scale",                                                                                                                                                                 
  scaleMin: 1,                                                                                                                                                                   
  scaleMax: 10,                                                                                                                                                                  
  guidance: "After the rating, ask what specifically drove that score. For low scores, acknowledge frustration.",                                                                
  timeHintSeconds: 90,                                                                                                                                                           
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "What, if anything, surprised you about the support interaction?",                                                                                                       
  type: "open",                                                                                                                                                                  
  guidance: "Surprises can be positive or negative. Explore expectations vs reality.",                                                                                           
  timeHintSeconds: 120,                                                                                                                                                          
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "Which support channel do you prefer to use: chat, email, or phone?",                                                                                                    
  type: "multi_select",                                                                                                                                                          
  multiSelectOptions: ["Live chat", "Email", "Phone", "Self-service/Help center", "Social media"],                                                                               
  guidance: "After selection, explore WHY they prefer that channel. What would make them use a different one?",                                                                  
  timeHintSeconds: 90,                                                                                                                                                           
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "Was your issue fully resolved?",                                                                                                                                        
  type: "yes_no",                                                                                                                                                                
  guidance: "If no, explore what's still unresolved and how that makes them feel. If yes, ask if the resolution met expectations.",                                              
  timeHintSeconds: 60,                                                                                                                                                           
  recommendedFollowUps: 2                                                                                                                                                        
  },                                                                                                                                                                             
  {                                                                                                                                                                              
  text: "If you could change one thing about how we handle support, what would it be?",                                                                                          
  type: "open",                                                                                                                                                                  
  guidance: "Listen for systemic issues vs one-off problems. Probe for specific, actionable suggestions.",                                                                       
  timeHintSeconds: 120,                                                                                                                                                          
  recommendedFollowUps: 1                                                                                                                                                        
  }                                                                                                                                                                              
  ]                                                                                                                                                                              
  }                                                                                                                                                                              
  ];                                                                                                                                                                             
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 5. Structure Generator (generators/structure.ts)                                                                                                                            
                                                                                                                                                                                 
  Creates the database hierarchy using the existing `DatabaseStorage` class:                                                                                                     
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/generators/structure.ts                                                                                                                              
                                                                                                                                                                                 
  import { DatabaseStorage } from '../../../server/storage';                                                                                                                     
  import type { Scenario } from '../scenarios';                                                                                                                                  
                                                                                                                                                                                 
  export interface GeneratedStructure {                                                                                                                                          
  workspaceId: string;                                                                                                                                                           
  projectId: string;                                                                                                                                                             
  templateId: string;                                                                                                                                                            
  collectionId: string;                                                                                                                                                          
  questionIds: string[];  // Ordered by question index                                                                                                                           
  }                                                                                                                                                                              
                                                                                                                                                                                 
  export async function generateStructure(                                                                                                                                       
  storage: DatabaseStorage,                                                                                                                                                      
  scenario: Scenario,                                                                                                                                                            
  userId: string                                                                                                                                                                 
  ): Promise<GeneratedStructure> {                                                                                                                                               
                                                                                                                                                                                 
  // 1. Create workspace                                                                                                                                                         
  const workspace = await storage.createWorkspace({                                                                                                                              
  name: `Test Workspace - ${scenario.name}`,                                                                                                                                     
  ownerId: userId,                                                                                                                                                               
  retentionDays: 90                                                                                                                                                              
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // 2. Add user as workspace owner                                                                                                                                              
  await storage.addWorkspaceMember({                                                                                                                                             
  workspaceId: workspace.id,                                                                                                                                                     
  userId: userId,                                                                                                                                                                
  role: 'owner'                                                                                                                                                                  
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // 3. Create project                                                                                                                                                           
  const project = await storage.createProject({                                                                                                                                  
  workspaceId: workspace.id,                                                                                                                                                     
  name: scenario.projectName,                                                                                                                                                    
  description: `Test project for ${scenario.name}`,                                                                                                                              
  objective: scenario.objective,                                                                                                                                                 
  audienceContext: scenario.audienceContext,                                                                                                                                     
  strategicContext: scenario.strategicContext,                                                                                                                                   
  contextType: scenario.contextType,                                                                                                                                             
  tone: scenario.tone,                                                                                                                                                           
  consentAudioRecording: true,                                                                                                                                                   
  piiRedactionEnabled: true,                                                                                                                                                     
  crossInterviewContext: true,                                                                                                                                                   
  crossInterviewThreshold: 5                                                                                                                                                     
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // 4. Create template                                                                                                                                                          
  const template = await storage.createTemplate({                                                                                                                                
  projectId: project.id,                                                                                                                                                         
  name: scenario.templateName,                                                                                                                                                   
  version: 1,                                                                                                                                                                    
  objective: scenario.objective,                                                                                                                                                 
  tone: scenario.tone,                                                                                                                                                           
  isActive: true,                                                                                                                                                                
  defaultRecommendedFollowUps: 2                                                                                                                                                 
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // 5. Create questions                                                                                                                                                         
  const questionIds: string[] = [];                                                                                                                                              
  for (let i = 0; i < scenario.questions.length; i++) {                                                                                                                          
  const q = scenario.questions[i];                                                                                                                                               
  const question = await storage.createQuestion({                                                                                                                                
  templateId: template.id,                                                                                                                                                       
  orderIndex: i,                                                                                                                                                                 
  questionText: q.text,                                                                                                                                                          
  questionType: q.type,                                                                                                                                                          
  guidance: q.guidance,                                                                                                                                                          
  scaleMin: q.scaleMin,                                                                                                                                                          
  scaleMax: q.scaleMax,                                                                                                                                                          
  multiSelectOptions: q.multiSelectOptions,                                                                                                                                      
  timeHintSeconds: q.timeHintSeconds,                                                                                                                                            
  recommendedFollowUps: q.recommendedFollowUps ?? 2,                                                                                                                             
  isRequired: true                                                                                                                                                               
  });                                                                                                                                                                            
  questionIds.push(question.id);                                                                                                                                                 
  }                                                                                                                                                                              
                                                                                                                                                                                 
  // 6. Create collection                                                                                                                                                        
  const collection = await storage.createCollection({                                                                                                                            
  templateId: template.id,                                                                                                                                                       
  name: scenario.collectionName,                                                                                                                                                 
  description: `Test collection for analytics testing`,                                                                                                                          
  isActive: true,                                                                                                                                                                
  targetResponses: 20                                                                                                                                                            
  });                                                                                                                                                                            
                                                                                                                                                                                 
  return {                                                                                                                                                                       
  workspaceId: workspace.id,                                                                                                                                                     
  projectId: project.id,                                                                                                                                                         
  templateId: template.id,                                                                                                                                                       
  collectionId: collection.id,                                                                                                                                                   
  questionIds                                                                                                                                                                    
  };                                                                                                                                                                             
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 6. Persona Generator (generators/personas.ts)                                                                                                                               
                                                                                                                                                                                 
  Generates diverse respondent personas using OpenAI:                                                                                                                            
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/generators/personas.ts                                                                                                                               
                                                                                                                                                                                 
  import OpenAI from 'openai';                                                                                                                                                   
  import { SEED_CONFIG, type QualityTendency } from '../config';                                                                                                                 
                                                                                                                                                                                 
  export interface GeneratedPersona {                                                                                                                                            
  name: string;                                                                                                                                                                  
  fullName: string;                                                                                                                                                              
  email: string;                                                                                                                                                                 
  background: string;                                                                                                                                                            
  traits: string[];                                                                                                                                                              
  opinions: string[];                                                                                                                                                            
  qualityTendency: QualityTendency;                                                                                                                                              
  sentimentLeaning: "positive" | "neutral" | "negative" | "mixed";                                                                                                               
  }                                                                                                                                                                              
                                                                                                                                                                                 
  const PERSONA_PROMPT = `Generate a realistic interview respondent persona for a research study.                                                                                
                                                                                                                                                                                 
  Study context: {objective}                                                                                                                                                     
  Audience: {audienceContext}                                                                                                                                                    
                                                                                                                                                                                 
  Create a persona with:                                                                                                                                                         
  1. A realistic first name and last name                                                                                                                                        
  2. Professional background (job title, company size, industry)                                                                                                                 
  3. 2-3 personality traits that affect how they communicate (e.g., "analytical and detail-oriented", "enthusiastic but scattered", "reserved but thoughtful")                   
  4. 2-3 specific opinions or experiences relevant to the study topic                                                                                                            
  5. A general sentiment leaning for this topic: positive, neutral, negative, or mixed                                                                                           
                                                                                                                                                                                 
  Return ONLY valid JSON (no markdown):                                                                                                                                          
  {                                                                                                                                                                              
  "firstName": "string",                                                                                                                                                         
  "lastName": "string",                                                                                                                                                          
  "background": "string describing role and context",                                                                                                                            
  "traits": ["trait1", "trait2"],                                                                                                                                                
  "opinions": ["opinion1", "opinion2"],                                                                                                                                          
  "sentimentLeaning": "positive|neutral|negative|mixed"                                                                                                                          
  }`;                                                                                                                                                                            
                                                                                                                                                                                 
  export async function generatePersonas(                                                                                                                                        
  openai: OpenAI,                                                                                                                                                                
  objective: string,                                                                                                                                                             
  audienceContext: string,                                                                                                                                                       
  count: number                                                                                                                                                                  
  ): Promise<GeneratedPersona[]> {                                                                                                                                               
  const personas: GeneratedPersona[] = [];                                                                                                                                       
                                                                                                                                                                                 
  // Determine quality distribution                                                                                                                                              
  const qualityAssignments = assignQualities(count);                                                                                                                             
                                                                                                                                                                                 
  for (let i = 0; i < count; i++) {                                                                                                                                              
  const prompt = PERSONA_PROMPT                                                                                                                                                  
  .replace('{objective}', objective)                                                                                                                                             
  .replace('{audienceContext}', audienceContext);                                                                                                                                
                                                                                                                                                                                 
  const response = await openai.chat.completions.create({                                                                                                                        
  model: SEED_CONFIG.model,                                                                                                                                                      
  messages: [{ role: 'user', content: prompt }],                                                                                                                                 
  temperature: 0.9,  // High temperature for variety                                                                                                                             
  response_format: { type: "json_object" }                                                                                                                                       
  });                                                                                                                                                                            
                                                                                                                                                                                 
  const content = response.choices[0].message.content;                                                                                                                           
  if (!content) throw new Error('Empty response from OpenAI');                                                                                                                   
                                                                                                                                                                                 
  const parsed = JSON.parse(content);                                                                                                                                            
                                                                                                                                                                                 
  personas.push({                                                                                                                                                                
  name: parsed.firstName,                                                                                                                                                        
  fullName: `${parsed.firstName} ${parsed.lastName}`,                                                                                                                            
  email: `${parsed.firstName.toLowerCase()}.${parsed.lastName.toLowerCase()}@test-${i}.com`,                                                                                     
  background: parsed.background,                                                                                                                                                 
  traits: parsed.traits,                                                                                                                                                         
  opinions: parsed.opinions,                                                                                                                                                     
  qualityTendency: qualityAssignments[i],                                                                                                                                        
  sentimentLeaning: parsed.sentimentLeaning                                                                                                                                      
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // Rate limiting - 100ms between calls                                                                                                                                         
  await new Promise(r => setTimeout(r, 100));                                                                                                                                    
  }                                                                                                                                                                              
                                                                                                                                                                                 
  return personas;                                                                                                                                                               
  }                                                                                                                                                                              
                                                                                                                                                                                 
  function assignQualities(count: number): QualityTendency[] {                                                                                                                   
  const assignments: QualityTendency[] = [];                                                                                                                                     
  const dist = SEED_CONFIG.qualityDistribution;                                                                                                                                  
                                                                                                                                                                                 
  // Calculate counts for each quality level                                                                                                                                     
  const counts = {                                                                                                                                                               
  high_quality: Math.round(count * dist.high_quality),                                                                                                                           
  moderate: Math.round(count * dist.moderate),                                                                                                                                   
  brief: Math.round(count * dist.brief),                                                                                                                                         
  off_topic: count - Math.round(count * dist.high_quality) - Math.round(count * dist.moderate) - Math.round(count * dist.brief)                                                  
  };                                                                                                                                                                             
                                                                                                                                                                                 
  // Create array with correct distribution                                                                                                                                      
  for (const [quality, c] of Object.entries(counts)) {                                                                                                                           
  for (let i = 0; i < c; i++) {                                                                                                                                                  
  assignments.push(quality as QualityTendency);                                                                                                                                  
  }                                                                                                                                                                              
  }                                                                                                                                                                              
                                                                                                                                                                                 
  // Shuffle                                                                                                                                                                     
  return assignments.sort(() => Math.random() - 0.5);                                                                                                                            
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 7. Conversation Generator (generators/conversations.ts)                                                                                                                     
                                                                                                                                                                                 
  The core LLM-powered conversation simulation:                                                                                                                                  
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/generators/conversations.ts                                                                                                                          
                                                                                                                                                                                 
  import OpenAI from 'openai';                                                                                                                                                   
  import { SEED_CONFIG, type QualityTendency } from '../config';                                                                                                                 
  import type { GeneratedPersona } from './personas';                                                                                                                            
  import type { ScenarioQuestion } from '../scenarios';                                                                                                                          
  import type { PersistedTranscriptEntry } from '@shared/schema';                                                                                                                
                                                                                                                                                                                 
  export interface GeneratedConversation {                                                                                                                                       
  transcript: PersistedTranscriptEntry[];                                                                                                                                        
  respondentText: string;  // Combined respondent text for this question                                                                                                         
  followUpCount: number;                                                                                                                                                         
  wordCount: number;                                                                                                                                                             
  }                                                                                                                                                                              
                                                                                                                                                                                 
  const CONVERSATION_PROMPT = `You are simulating a voice interview between Alvia (an AI interviewer) and {respondentName} (the respondent).                                     
                                                                                                                                                                                 
  CONTEXT:                                                                                                                                                                       
  - Interview objective: {objective}                                                                                                                                             
  - Respondent background: {background}                                                                                                                                          
  - Respondent personality traits: {traits}                                                                                                                                      
  - Respondent's relevant opinions: {opinions}                                                                                                                                   
  - Respondent's general sentiment: {sentimentLeaning}                                                                                                                           
  - Response quality to simulate: {qualityTendency}                                                                                                                              
  - Previous Q&A context: {previousContext}                                                                                                                                      
                                                                                                                                                                                 
  CURRENT QUESTION:                                                                                                                                                              
  Question: "{questionText}"                                                                                                                                                     
  Question type: {questionType}                                                                                                                                                  
  Interviewer guidance: {guidance}                                                                                                                                               
                                                                                                                                                                                 
  QUALITY GUIDELINES for "{qualityTendency}":                                                                                                                                    
  {qualityGuidelines}                                                                                                                                                            
                                                                                                                                                                                 
  Generate a realistic multi-turn conversation:                                                                                                                                  
  1. Alvia asks the question (naturally adapted to context, not reading verbatim)                                                                                                
  2. Respondent answers (matching their persona and quality level)                                                                                                               
  3. Alvia asks {followUpCount} follow-up question(s) probing deeper                                                                                                             
  4. Respondent responds to each follow-up                                                                                                                                       
                                                                                                                                                                                 
  {extractionInstructions}                                                                                                                                                       
                                                                                                                                                                                 
  Return ONLY valid JSON (no markdown):                                                                                                                                          
  {                                                                                                                                                                              
  "turns": [                                                                                                                                                                     
  { "speaker": "alvia", "text": "..." },                                                                                                                                         
  { "speaker": "respondent", "text": "..." },                                                                                                                                    
  ...                                                                                                                                                                            
  ],                                                                                                                                                                             
  "extractedValue": null or value based on question type                                                                                                                         
  }`;                                                                                                                                                                            
                                                                                                                                                                                 
  const QUALITY_GUIDELINES: Record<QualityTendency, string> = {                                                                                                                  
  high_quality: `- Give detailed, specific responses with concrete examples                                                                                                      
  - Show emotional depth and personal investment in the topic                                                                                                                    
  - Provide 100-300 words per response                                                                                                                                           
  - Stay focused and articulate clear points                                                                                                                                     
  - Offer unsolicited insights that go beyond the question`,                                                                                                                     
                                                                                                                                                                                 
  moderate: `- Give reasonable responses with some detail                                                                                                                        
  - Show moderate engagement with the topic                                                                                                                                      
  - Provide 50-150 words per response                                                                                                                                            
  - Stay mostly on topic with occasional tangents                                                                                                                                
  - Answer what's asked without much elaboration`,                                                                                                                               
                                                                                                                                                                                 
  brief: `- Give short, surface-level responses                                                                                                                                  
  - Require probing to get details                                                                                                                                               
  - Provide 15-50 words per response                                                                                                                                             
  - Answer literally without much context                                                                                                                                        
  - Need follow-up questions to get useful information`,                                                                                                                         
                                                                                                                                                                                 
  off_topic: `- Tend to go on tangents related but not directly answering                                                                                                        
  - Include some irrelevant personal anecdotes                                                                                                                                   
  - Provide 80-200 words but much is tangential                                                                                                                                  
  - Eventually answer but in a roundabout way                                                                                                                                    
  - Show signs of not fully understanding the question`                                                                                                                          
  };                                                                                                                                                                             
                                                                                                                                                                                 
  export async function generateConversation(                                                                                                                                    
  openai: OpenAI,                                                                                                                                                                
  persona: GeneratedPersona,                                                                                                                                                     
  question: ScenarioQuestion,                                                                                                                                                    
  questionIndex: number,                                                                                                                                                         
  objective: string,                                                                                                                                                             
  previousContext: string,                                                                                                                                                       
  baseTimestamp: number                                                                                                                                                          
  ): Promise<GeneratedConversation> {                                                                                                                                            
                                                                                                                                                                                 
  const characteristics = SEED_CONFIG.responseCharacteristics[persona.qualityTendency];                                                                                          
  const followUpCount = characteristics.followUpDepth;                                                                                                                           
                                                                                                                                                                                 
  let extractionInstructions = '';                                                                                                                                               
  if (question.type === 'scale') {                                                                                                                                               
  extractionInstructions = `The respondent should give a number from ${question.scaleMin} to ${question.scaleMax}. Set extractedValue to this number.`;                          
  } else if (question.type === 'yes_no') {                                                                                                                                       
  extractionInstructions = `The respondent should clearly indicate yes or no. Set extractedValue to true (yes) or false (no).`;                                                  
  } else if (question.type === 'numeric') {                                                                                                                                      
  extractionInstructions = `If the respondent mentions a specific number relevant to the question, set extractedValue to that number.`;                                          
  } else if (question.type === 'multi_select') {                                                                                                                                 
  extractionInstructions = `Options are: ${question.multiSelectOptions?.join(', ')}. Set extractedValue to an array of the options the respondent mentions.`;                    
  }                                                                                                                                                                              
                                                                                                                                                                                 
  const prompt = CONVERSATION_PROMPT                                                                                                                                             
  .replace('{respondentName}', persona.name)                                                                                                                                     
  .replace('{objective}', objective)                                                                                                                                             
  .replace('{background}', persona.background)                                                                                                                                   
  .replace('{traits}', persona.traits.join(', '))                                                                                                                                
  .replace('{opinions}', persona.opinions.join('; '))                                                                                                                            
  .replace('{sentimentLeaning}', persona.sentimentLeaning)                                                                                                                       
  .replace('{qualityTendency}', persona.qualityTendency)                                                                                                                         
  .replace('{previousContext}', previousContext || 'This is the first question.')                                                                                                
  .replace('{questionText}', question.text)                                                                                                                                      
  .replace('{questionType}', question.type)                                                                                                                                      
  .replace('{guidance}', question.guidance)                                                                                                                                      
  .replace('{qualityGuidelines}', QUALITY_GUIDELINES[persona.qualityTendency])                                                                                                   
  .replace('{followUpCount}', String(followUpCount))                                                                                                                             
  .replace('{extractionInstructions}', extractionInstructions);                                                                                                                  
                                                                                                                                                                                 
  const response = await openai.chat.completions.create({                                                                                                                        
  model: SEED_CONFIG.model,                                                                                                                                                      
  messages: [{ role: 'user', content: prompt }],                                                                                                                                 
  temperature: 0.8,                                                                                                                                                              
  response_format: { type: "json_object" }                                                                                                                                       
  });                                                                                                                                                                            
                                                                                                                                                                                 
  const content = response.choices[0].message.content;                                                                                                                           
  if (!content) throw new Error('Empty response from OpenAI');                                                                                                                   
                                                                                                                                                                                 
  const parsed = JSON.parse(content);                                                                                                                                            
                                                                                                                                                                                 
  // Convert to PersistedTranscriptEntry format with timestamps                                                                                                                  
  const transcript: PersistedTranscriptEntry[] = [];                                                                                                                             
  let currentTime = baseTimestamp;                                                                                                                                               
  let respondentText = '';                                                                                                                                                       
                                                                                                                                                                                 
  for (const turn of parsed.turns) {                                                                                                                                             
  transcript.push({                                                                                                                                                              
  speaker: turn.speaker,                                                                                                                                                         
  text: turn.text,                                                                                                                                                               
  timestamp: currentTime,                                                                                                                                                        
  questionIndex                                                                                                                                                                  
  });                                                                                                                                                                            
                                                                                                                                                                                 
  if (turn.speaker === 'respondent') {                                                                                                                                           
  respondentText += turn.text + ' ';                                                                                                                                             
  }                                                                                                                                                                              
                                                                                                                                                                                 
  // Realistic timing: Alvia 2-4s, Respondent based on text length (~60ms per character for speech)                                                                              
  const speakingTime = turn.speaker === 'alvia'                                                                                                                                  
  ? 2000 + Math.random() * 2000                                                                                                                                                  
  : Math.min(turn.text.length * 60, 45000);  // Cap at 45 seconds                                                                                                                
                                                                                                                                                                                 
  currentTime += speakingTime + 500; // 500ms pause between turns                                                                                                                
  }                                                                                                                                                                              
                                                                                                                                                                                 
  const wordCount = respondentText.trim().split(/\s+/).length;                                                                                                                   
                                                                                                                                                                                 
  return {                                                                                                                                                                       
  transcript,                                                                                                                                                                    
  respondentText: respondentText.trim(),                                                                                                                                         
  followUpCount,                                                                                                                                                                 
  wordCount                                                                                                                                                                      
  };                                                                                                                                                                             
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 8. Summary Generator (generators/summaries.ts)                                                                                                                              
                                                                                                                                                                                 
  Generates question summaries with verbatims and quality metrics:                                                                                                               
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/generators/summaries.ts                                                                                                                              
                                                                                                                                                                                 
  import OpenAI from 'openai';                                                                                                                                                   
  import { SEED_CONFIG, type QualityTendency } from '../config';                                                                                                                 
  import type {                                                                                                                                                                  
  QuestionSummary,                                                                                                                                                               
  VerbatimStatement,                                                                                                                                                             
  KeyQuote,                                                                                                                                                                      
  QualityFlag,                                                                                                                                                                   
  ExtractedValues                                                                                                                                                                
  } from '@shared/schema';                                                                                                                                                       
                                                                                                                                                                                 
  const SUMMARY_PROMPT = `Analyze this interview response and generate a structured summary.                                                                                     
                                                                                                                                                                                 
  Question: "{questionText}"                                                                                                                                                     
  Respondent's full response (across all turns): "{respondentText}"                                                                                                              
  Respondent quality tendency: {qualityTendency}                                                                                                                                 
                                                                                                                                                                                 
  Generate:                                                                                                                                                                      
  1. A 2-3 sentence summary of what the respondent said                                                                                                                          
  2. 3-5 key insights as bullet points                                                                                                                                           
  3. An assessment of answer completeness                                                                                                                                        
  4. 2-4 verbatim quotes worth highlighting, with sentiment and theme tags                                                                                                       
  5. Quality flags if applicable: incomplete, ambiguous, contradiction, off_topic, low_engagement                                                                                
  6. A quality score from 0-100                                                                                                                                                  
                                                                                                                                                                                 
  Return ONLY valid JSON:                                                                                                                                                        
  {                                                                                                                                                                              
  "respondentSummary": "string",                                                                                                                                                 
  "keyInsights": ["insight1", "insight2", ...],                                                                                                                                  
  "completenessAssessment": "string",                                                                                                                                            
  "verbatims": [                                                                                                                                                                 
  { "quote": "exact quote", "context": "what prompted this", "sentiment": "positive|negative|neutral|mixed", "themeTag": "short theme name" }                                    
  ],                                                                                                                                                                             
  "qualityFlags": ["flag1"] or [],                                                                                                                                               
  "qualityScore": number,                                                                                                                                                        
  "qualityNotes": "brief explanation of score"                                                                                                                                   
  }`;                                                                                                                                                                            
                                                                                                                                                                                 
  export async function generateQuestionSummary(                                                                                                                                 
  openai: OpenAI,                                                                                                                                                                
  questionText: string,                                                                                                                                                          
  questionIndex: number,                                                                                                                                                         
  respondentText: string,                                                                                                                                                        
  qualityTendency: QualityTendency,                                                                                                                                              
  wordCount: number,                                                                                                                                                             
  turnCount: number,                                                                                                                                                             
  activeTimeMs: number                                                                                                                                                           
  ): Promise<QuestionSummary> {                                                                                                                                                  
                                                                                                                                                                                 
  const prompt = SUMMARY_PROMPT                                                                                                                                                  
  .replace('{questionText}', questionText)                                                                                                                                       
  .replace('{respondentText}', respondentText)                                                                                                                                   
  .replace('{qualityTendency}', qualityTendency);                                                                                                                                
                                                                                                                                                                                 
  const response = await openai.chat.completions.create({                                                                                                                        
  model: SEED_CONFIG.model,                                                                                                                                                      
  messages: [{ role: 'user', content: prompt }],                                                                                                                                 
  temperature: 0.3,  // Lower temperature for consistency                                                                                                                        
  response_format: { type: "json_object" }                                                                                                                                       
  });                                                                                                                                                                            
                                                                                                                                                                                 
  const content = response.choices[0].message.content;                                                                                                                           
  if (!content) throw new Error('Empty response from OpenAI');                                                                                                                   
                                                                                                                                                                                 
  const parsed = JSON.parse(content);                                                                                                                                            
                                                                                                                                                                                 
  // Adjust quality score based on quality tendency                                                                                                                              
  let adjustedScore = parsed.qualityScore;                                                                                                                                       
  if (qualityTendency === 'high_quality') {                                                                                                                                      
  adjustedScore = Math.max(adjustedScore, 75);                                                                                                                                   
  } else if (qualityTendency === 'brief') {                                                                                                                                      
  adjustedScore = Math.min(adjustedScore, 60);                                                                                                                                   
  } else if (qualityTendency === 'off_topic') {                                                                                                                                  
  adjustedScore = Math.min(adjustedScore, 50);                                                                                                                                   
  }                                                                                                                                                                              
                                                                                                                                                                                 
  return {                                                                                                                                                                       
  questionIndex,                                                                                                                                                                 
  questionText,                                                                                                                                                                  
  respondentSummary: parsed.respondentSummary,                                                                                                                                   
  keyInsights: parsed.keyInsights,                                                                                                                                               
  completenessAssessment: parsed.completenessAssessment,                                                                                                                         
  relevantToFutureQuestions: [], // Can be populated if needed                                                                                                                   
  wordCount,                                                                                                                                                                     
  turnCount,                                                                                                                                                                     
  activeTimeMs,                                                                                                                                                                  
  timestamp: Date.now(),                                                                                                                                                         
  qualityFlags: parsed.qualityFlags as QualityFlag[],                                                                                                                            
  qualityScore: adjustedScore,                                                                                                                                                   
  qualityNotes: parsed.qualityNotes,                                                                                                                                             
  verbatims: parsed.verbatims as VerbatimStatement[]                                                                                                                             
  };                                                                                                                                                                             
  }                                                                                                                                                                              
                                                                                                                                                                                 
  export function extractKeyQuotes(                                                                                                                                              
  verbatims: VerbatimStatement[],                                                                                                                                                
  transcript: Array<{ speaker: string; text: string; timestamp: number }>                                                                                                        
  ): KeyQuote[] {                                                                                                                                                                
  // Find timestamps for verbatim quotes in transcript                                                                                                                           
  return verbatims.slice(0, 3).map(v => {                                                                                                                                        
  // Find the transcript entry that contains this quote                                                                                                                          
  const entry = transcript.find(t =>                                                                                                                                             
  t.speaker === 'respondent' && t.text.includes(v.quote.substring(0, 30))                                                                                                        
  );                                                                                                                                                                             
                                                                                                                                                                                 
  return {                                                                                                                                                                       
  quote: v.quote,                                                                                                                                                                
  speaker: 'respondent' as const,                                                                                                                                                
  startTimeMs: entry?.timestamp,                                                                                                                                                 
  endTimeMs: entry ? entry.timestamp + v.quote.length * 60 : undefined                                                                                                           
  };                                                                                                                                                                             
  });                                                                                                                                                                            
  }                                                                                                                                                                              
                                                                                                                                                                                 
  export function buildExtractedValues(                                                                                                                                          
  questionType: string,                                                                                                                                                          
  extractedValue: any,                                                                                                                                                           
  scaleMin?: number,                                                                                                                                                             
  scaleMax?: number                                                                                                                                                              
  ): ExtractedValues {                                                                                                                                                           
  const values: ExtractedValues = {};                                                                                                                                            
                                                                                                                                                                                 
  if (questionType === 'scale' && typeof extractedValue === 'number') {                                                                                                          
  values.scale = Math.max(scaleMin || 1, Math.min(scaleMax || 10, extractedValue));                                                                                              
  } else if (questionType === 'yes_no' && typeof extractedValue === 'boolean') {                                                                                                 
  values.yesNo = extractedValue;                                                                                                                                                 
  } else if (questionType === 'numeric' && typeof extractedValue === 'number') {                                                                                                 
  values.numeric = extractedValue;                                                                                                                                               
  } else if (questionType === 'multi_select' && Array.isArray(extractedValue)) {                                                                                                 
  values.multiSelect = extractedValue;                                                                                                                                           
  }                                                                                                                                                                              
                                                                                                                                                                                 
  return values;                                                                                                                                                                 
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 9. Timestamp Utilities (utils/timestamps.ts)                                                                                                                                
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/utils/timestamps.ts                                                                                                                                  
                                                                                                                                                                                 
  export function generateSessionTimestamps(questionCount: number): {                                                                                                            
  sessionStart: Date;                                                                                                                                                            
  baseTimestamps: number[];  // Base timestamp for each question                                                                                                                 
  totalDurationMs: number;                                                                                                                                                       
  } {                                                                                                                                                                            
  // Session started sometime in the last 7 days                                                                                                                                 
  const daysAgo = Math.floor(Math.random() * 7);                                                                                                                                 
  const sessionStart = new Date();                                                                                                                                               
  sessionStart.setDate(sessionStart.getDate() - daysAgo);                                                                                                                        
  sessionStart.setHours(9 + Math.floor(Math.random() * 9)); // 9am-6pm                                                                                                           
  sessionStart.setMinutes(Math.floor(Math.random() * 60));                                                                                                                       
                                                                                                                                                                                 
  // Generate base timestamps for each question                                                                                                                                  
  const baseTimestamps: number[] = [];                                                                                                                                           
  let currentTime = sessionStart.getTime();                                                                                                                                      
                                                                                                                                                                                 
  // Initial greeting/intro: 30-60 seconds                                                                                                                                       
  currentTime += 30000 + Math.random() * 30000;                                                                                                                                  
                                                                                                                                                                                 
  for (let i = 0; i < questionCount; i++) {                                                                                                                                      
  baseTimestamps.push(currentTime);                                                                                                                                              
  // Each question takes 2-5 minutes                                                                                                                                             
  currentTime += 120000 + Math.random() * 180000;                                                                                                                                
  }                                                                                                                                                                              
                                                                                                                                                                                 
  const totalDurationMs = currentTime - sessionStart.getTime();                                                                                                                  
                                                                                                                                                                                 
  return { sessionStart, baseTimestamps, totalDurationMs };                                                                                                                      
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 10. Main Entry Point (index.ts)                                                                                                                                             
                                                                                                                                                                                 
  ```typescript                                                                                                                                                                  
  // scripts/seed-test-data/index.ts                                                                                                                                             
                                                                                                                                                                                 
  import OpenAI from 'openai';                                                                                                                                                   
  import { DatabaseStorage } from '../../server/storage';                                                                                                                        
  import { db } from '../../server/db';                                                                                                                                          
  import { SEED_CONFIG } from './config';                                                                                                                                        
  import { SCENARIOS } from './scenarios';                                                                                                                                       
  import { generateStructure } from './generators/structure';                                                                                                                    
  import { generatePersonas } from './generators/personas';                                                                                                                      
  import { generateConversation } from './generators/conversations';                                                                                                             
  import { generateQuestionSummary, extractKeyQuotes, buildExtractedValues } from './generators/summaries';                                                                      
  import { generateSessionTimestamps } from './utils/timestamps';                                                                                                                
  import type {                                                                                                                                                                  
  PersistedTranscriptEntry,                                                                                                                                                      
  PersistedQuestionState,                                                                                                                                                        
  QuestionSummary                                                                                                                                                                
  } from '@shared/schema';                                                                                                                                                       
                                                                                                                                                                                 
  async function main() {                                                                                                                                                        
  console.log('🚀 Starting Analytics Test Harness\n');                                                                                                                           
                                                                                                                                                                                 
  // Parse CLI arguments                                                                                                                                                         
  const args = process.argv.slice(2);                                                                                                                                            
  const dryRun = args.includes('--dry-run');                                                                                                                                     
  const scenarioFilter = args.find(a => a.startsWith('--scenario='))?.split('=')[1];                                                                                             
  const countOverride = parseInt(args.find(a => a.startsWith('--count='))?.split('=')[1] || '0');                                                                                
                                                                                                                                                                                 
  const respondentCount = countOverride || SEED_CONFIG.respondentsPerCollection;                                                                                                 
                                                                                                                                                                                 
  // Initialize OpenAI                                                                                                                                                           
  const openai = new OpenAI({ apiKey: process.env.OPENAI_API_KEY });                                                                                                             
                                                                                                                                                                                 
  // Initialize storage                                                                                                                                                          
  const storage = new DatabaseStorage(db);                                                                                                                                       
                                                                                                                                                                                 
  // Get or create test user                                                                                                                                                     
  const testUserId = 'test-harness-user';                                                                                                                                        
                                                                                                                                                                                 
  // Filter scenarios if specified                                                                                                                                               
  const scenariosToRun = scenarioFilter                                                                                                                                          
  ? SCENARIOS.filter(s => s.name.toLowerCase().includes(scenarioFilter.toLowerCase()))                                                                                           
  : SCENARIOS;                                                                                                                                                                   
                                                                                                                                                                                 
  console.log(`📋 Running ${scenariosToRun.length} scenario(s) with ${respondentCount} respondents each\n`);                                                                     
                                                                                                                                                                                 
  for (const scenario of scenariosToRun) {                                                                                                                                       
  console.log(`\n${'='.repeat(60)}`);                                                                                                                                            
  console.log(`📁 Scenario: ${scenario.name}`);                                                                                                                                  
  console.log(`${'='.repeat(60)}\n`);                                                                                                                                            
                                                                                                                                                                                 
  // 1. Create structure                                                                                                                                                         
  console.log('📂 Creating project structure...');                                                                                                                               
  const structure = await generateStructure(storage, scenario, testUserId);                                                                                                      
  console.log(`   ✓ Workspace: ${structure.workspaceId}`);                                                                                                                       
  console.log(`   ✓ Project: ${structure.projectId}`);                                                                                                                           
  console.log(`   ✓ Template: ${structure.templateId}`);                                                                                                                         
  console.log(`   ✓ Collection: ${structure.collectionId}`);                                                                                                                     
  console.log(`   ✓ Questions: ${structure.questionIds.length}`);                                                                                                                
                                                                                                                                                                                 
  // 2. Generate personas                                                                                                                                                        
  console.log(`\n👥 Generating ${respondentCount} respondent personas...`);                                                                                                      
  const personas = await generatePersonas(                                                                                                                                       
  openai,                                                                                                                                                                        
  scenario.objective,                                                                                                                                                            
  scenario.audienceContext,                                                                                                                                                      
  respondentCount                                                                                                                                                                
  );                                                                                                                                                                             
  console.log(`   ✓ Generated personas with quality distribution:`);                                                                                                             
  const qualityCounts = personas.reduce((acc, p) => {                                                                                                                            
  acc[p.qualityTendency] = (acc[p.qualityTendency] || 0) + 1;                                                                                                                    
  return acc;                                                                                                                                                                    
  }, {} as Record<string, number>);                                                                                                                                              
  Object.entries(qualityCounts).forEach(([q, c]) => console.log(`      - ${q}: ${c}`));                                                                                          
                                                                                                                                                                                 
  // 3. Simulate interviews                                                                                                                                                      
  console.log(`\n🎙️  Simulating ${respondentCount} interviews...`);                                                                                                              
                                                                                                                                                                                 
  for (let i = 0; i < personas.length; i++) {                                                                                                                                    
  const persona = personas[i];                                                                                                                                                   
  console.log(`\n   [${i + 1}/${respondentCount}] ${persona.fullName} (${persona.qualityTendency})`);                                                                            
                                                                                                                                                                                 
  // Create respondent                                                                                                                                                           
  const respondent = await storage.createRespondent({                                                                                                                            
  collectionId: structure.collectionId,                                                                                                                                          
  email: persona.email,                                                                                                                                                          
  displayName: persona.name,                                                                                                                                                     
  fullName: persona.fullName,                                                                                                                                                    
  informalName: persona.name,                                                                                                                                                    
  profileFields: {                                                                                                                                                               
  background: persona.background,                                                                                                                                                
  traits: persona.traits                                                                                                                                                         
  }                                                                                                                                                                              
  });                                                                                                                                                                            
                                                                                                                                                                                 
  // Generate timestamps                                                                                                                                                         
  const { sessionStart, baseTimestamps, totalDurationMs } = generateSessionTimestamps(                                                                                           
  scenario.questions.length                                                                                                                                                      
  );                                                                                                                                                                             
                                                                                                                                                                                 
  // Simulate interview                                                                                                                                                          
  const allTranscript: PersistedTranscriptEntry[] = [];                                                                                                                          
  const questionStates: PersistedQuestionState[] = [];                                                                                                                           
  const questionSummaries: QuestionSummary[] = [];                                                                                                                               
  let previousContext = '';                                                                                                                                                      
                                                                                                                                                                                 
  for (let qIndex = 0; qIndex < scenario.questions.length; qIndex++) {                                                                                                           
  const question = scenario.questions[qIndex];                                                                                                                                   
                                                                                                                                                                                 
  // Generate conversation                                                                                                                                                       
  const conversation = await generateConversation(                                                                                                                               
  openai,                                                                                                                                                                        
  persona,                                                                                                                                                                       
  question,                                                                                                                                                                      
  qIndex,                                                                                                                                                                        
  scenario.objective,                                                                                                                                                            
  previousContext,                                                                                                                                                               
  baseTimestamps[qIndex]                                                                                                                                                         
  );                                                                                                                                                                             
                                                                                                                                                                                 
  allTranscript.push(...conversation.transcript);                                                                                                                                
                                                                                                                                                                                 
  // Build question state                                                                                                                                                        
  const questionState: PersistedQuestionState = {                                                                                                                                
  questionIndex: qIndex,                                                                                                                                                         
  status: 'answered',                                                                                                                                                            
  barbaraSuggestedMoveOn: Math.random() > 0.7,                                                                                                                                   
  wordCount: conversation.wordCount,                                                                                                                                             
  activeTimeMs: conversation.transcript.length > 0                                                                                                                               
  ? conversation.transcript[conversation.transcript.length - 1].timestamp - conversation.transcript[0].timestamp                                                                 
  : 60000,                                                                                                                                                                       
  turnCount: conversation.transcript.length,                                                                                                                                     
  followUpCount: conversation.followUpCount                                                                                                                                      
  };                                                                                                                                                                             
  questionStates.push(questionState);                                                                                                                                            
                                                                                                                                                                                 
  // Generate summary                                                                                                                                                            
  const summary = await generateQuestionSummary(                                                                                                                                 
  openai,                                                                                                                                                                        
  question.text,                                                                                                                                                                 
  qIndex,                                                                                                                                                                        
  conversation.respondentText,                                                                                                                                                   
  persona.qualityTendency,                                                                                                                                                       
  conversation.wordCount,                                                                                                                                                        
  conversation.transcript.length,                                                                                                                                                
  questionState.activeTimeMs                                                                                                                                                     
  );                                                                                                                                                                             
  questionSummaries.push(summary);                                                                                                                                               
                                                                                                                                                                                 
  // Create segment                                                                                                                                                              
  const keyQuotes = extractKeyQuotes(summary.verbatims || [], conversation.transcript);                                                                                          
  const extractedValues = buildExtractedValues(                                                                                                                                  
  question.type,                                                                                                                                                                 
  null, // extractedValue from conversation if available                                                                                                                         
  question.scaleMin,                                                                                                                                                             
  question.scaleMax                                                                                                                                                              
  );                                                                                                                                                                             
                                                                                                                                                                                 
  if (!dryRun) {                                                                                                                                                                 
  await storage.createSegment({                                                                                                                                                  
  sessionId: '', // Will be set after session creation                                                                                                                           
  questionId: structure.questionIds[qIndex],                                                                                                                                     
  transcript: conversation.respondentText,                                                                                                                                       
  startTimeMs: conversation.transcript[0]?.timestamp,                                                                                                                            
  endTimeMs: conversation.transcript[conversation.transcript.length - 1]?.timestamp,                                                                                             
  summaryBullets: summary.keyInsights.slice(0, 3),                                                                                                                               
  keyQuotes,                                                                                                                                                                     
  extractedValues,                                                                                                                                                               
  confidence: summary.qualityScore,                                                                                                                                              
  qualityFlags: summary.qualityFlags                                                                                                                                             
  });                                                                                                                                                                            
  }                                                                                                                                                                              
                                                                                                                                                                                 
  // Update context for next question                                                                                                                                            
  previousContext += `Q${qIndex + 1}: ${question.text}\nSummary: ${summary.respondentSummary}\n\n`;                                                                              
                                                                                                                                                                                 
  process.stdout.write('.');                                                                                                                                                     
  }                                                                                                                                                                              
                                                                                                                                                                                 
  // Create session with all JSONB fields                                                                                                                                        
  if (!dryRun) {                                                                                                                                                                 
  await storage.createSession({                                                                                                                                                  
  collectionId: structure.collectionId,                                                                                                                                          
  respondentId: respondent.id,                                                                                                                                                   
  status: 'completed',                                                                                                                                                           
  currentQuestionIndex: scenario.questions.length,                                                                                                                               
  startedAt: sessionStart,                                                                                                                                                       
  completedAt: new Date(sessionStart.getTime() + totalDurationMs),                                                                                                               
  totalDurationMs,                                                                                                                                                               
  liveTranscript: allTranscript,                                                                                                                                                 
  questionStates,                                                                                                                                                                
  questionSummaries                                                                                                                                                              
  });                                                                                                                                                                            
  }                                                                                                                                                                              
                                                                                                                                                                                 
  console.log(` ✓ (${questionSummaries.length} questions, ${allTranscript.length} turns)`);                                                                                      
  }                                                                                                                                                                              
  }                                                                                                                                                                              
                                                                                                                                                                                 
  console.log(`\n${'='.repeat(60)}`);                                                                                                                                            
  console.log('✅ Test harness complete!');                                                                                                                                      
  console.log(`${'='.repeat(60)}`);                                                                                                                                              
  console.log(`\nGenerated:`);                                                                                                                                                   
  console.log(`- ${scenariosToRun.length} project(s)`);                                                                                                                          
  console.log(`- ${scenariosToRun.length} template(s)`);                                                                                                                         
  console.log(`- ${scenariosToRun.length} collection(s)`);                                                                                                                       
  console.log(`- ${scenariosToRun.length * respondentCount} completed session(s)`);                                                                                              
  console.log(`- ${scenariosToRun.length * respondentCount * SEED_CONFIG.questionsPerTemplate} segment(s)`);                                                                     
                                                                                                                                                                                 
  if (dryRun) {                                                                                                                                                                  
  console.log('\n⚠️  DRY RUN - No data was written to the database');                                                                                                            
  } else {                                                                                                                                                                       
  console.log('\n📊 To test analytics, navigate to:');                                                                                                                           
  console.log('   - Collection detail page → Click "Refresh Analytics"');                                                                                                        
  console.log('   - Template detail page → Click "Refresh Analytics"');                                                                                                          
  console.log('   - Project analytics page → Click "Refresh Analytics"');                                                                                                        
  }                                                                                                                                                                              
  }                                                                                                                                                                              
                                                                                                                                                                                 
  main().catch(console.error);                                                                                                                                                   
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 11. Package.json Script                                                                                                                                                     
                                                                                                                                                                                 
  Add this to `package.json`:                                                                                                                                                    
                                                                                                                                                                                 
  ```json                                                                                                                                                                        
  {                                                                                                                                                                              
  "scripts": {                                                                                                                                                                   
  "seed:test": "tsx scripts/seed-test-data/index.ts",                                                                                                                            
  "seed:test:dry": "tsx scripts/seed-test-data/index.ts --dry-run"                                                                                                               
  }                                                                                                                                                                              
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 12. Types Reference                                                                                                                                                         
                                                                                                                                                                                 
  The following types from `shared/schema.ts` must be used exactly as defined:                                                                                                   
                                                                                                                                                                                 
  ### PersistedTranscriptEntry                                                                                                                                                   
  ```typescript                                                                                                                                                                  
  {                                                                                                                                                                              
  speaker: "alvia" | "respondent";                                                                                                                                               
  text: string;                                                                                                                                                                  
  timestamp: number;      // Unix epoch milliseconds                                                                                                                             
  questionIndex: number;  // 0-based index                                                                                                                                       
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ### PersistedQuestionState                                                                                                                                                     
  ```typescript                                                                                                                                                                  
  {                                                                                                                                                                              
  questionIndex: number;                                                                                                                                                         
  status: "not_started" | "in_progress" | "answered" | "skipped";                                                                                                                
  barbaraSuggestedMoveOn: boolean;                                                                                                                                               
  wordCount: number;                                                                                                                                                             
  activeTimeMs: number;                                                                                                                                                          
  turnCount: number;                                                                                                                                                             
  followUpCount: number;                                                                                                                                                         
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ### QuestionSummary                                                                                                                                                            
  ```typescript                                                                                                                                                                  
  {                                                                                                                                                                              
  questionIndex: number;                                                                                                                                                         
  questionText: string;                                                                                                                                                          
  respondentSummary: string;                                                                                                                                                     
  keyInsights: string[];                                                                                                                                                         
  completenessAssessment: string;                                                                                                                                                
  relevantToFutureQuestions: string[];                                                                                                                                           
  wordCount: number;                                                                                                                                                             
  turnCount: number;                                                                                                                                                             
  activeTimeMs: number;                                                                                                                                                          
  timestamp: number;                                                                                                                                                             
  qualityFlags?: QualityFlag[];                                                                                                                                                  
  qualityScore?: number;                                                                                                                                                         
  qualityNotes?: string;                                                                                                                                                         
  verbatims?: VerbatimStatement[];                                                                                                                                               
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ### VerbatimStatement                                                                                                                                                          
  ```typescript                                                                                                                                                                  
  {                                                                                                                                                                              
  quote: string;                                                                                                                                                                 
  context: string;                                                                                                                                                               
  sentiment?: "positive" | "negative" | "neutral" | "mixed";                                                                                                                     
  themeTag?: string;                                                                                                                                                             
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ### KeyQuote                                                                                                                                                                   
  ```typescript                                                                                                                                                                  
  {                                                                                                                                                                              
  quote: string;                                                                                                                                                                 
  speaker: "respondent" | "alvia";                                                                                                                                               
  startTimeMs?: number;                                                                                                                                                          
  endTimeMs?: number;                                                                                                                                                            
  audioRef?: string;                                                                                                                                                             
  }                                                                                                                                                                              
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ### QualityFlag                                                                                                                                                                
  ```typescript                                                                                                                                                                  
  "incomplete" | "ambiguous" | "contradiction" | "distress_cue" | "off_topic" | "low_engagement"                                                                                 
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 13. Expected Output                                                                                                                                                         
                                                                                                                                                                                 
  With 2 scenarios × 18 respondents each:                                                                                                                                        
                                                                                                                                                                                 
  | Entity | Count |                                                                                                                                                             
  |--------|-------|                                                                                                                                                             
  | Workspaces | 2 |                                                                                                                                                             
  | Projects | 2 |                                                                                                                                                               
  | Templates | 2 |                                                                                                                                                              
  | Collections | 2 |                                                                                                                                                            
  | Respondents | 36 |                                                                                                                                                           
  | Sessions | 36 |                                                                                                                                                              
  | Segments | ~216 (36 × 6 questions) |                                                                                                                                         
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 14. Verification Steps                                                                                                                                                      
                                                                                                                                                                                 
  After running `npm run seed:test`:                                                                                                                                             
                                                                                                                                                                                 
  1. **Verify data in database:**                                                                                                                                                
  ```bash                                                                                                                                                                        
  psql $DATABASE_URL -c "SELECT COUNT(*) FROM interview_sessions WHERE status = 'completed'"                                                                                     
  # Expected: 36                                                                                                                                                                 
  ```                                                                                                                                                                            
                                                                                                                                                                                 
  2. **Test Collection analytics:**                                                                                                                                              
  - Navigate to any collection detail page                                                                                                                                       
  - Click "Refresh Analytics"                                                                                                                                                    
  - Verify themes, verbatims, key findings, and recommendations populate                                                                                                         
                                                                                                                                                                                 
  3. **Test Template analytics:**                                                                                                                                                
  - Navigate to template detail page                                                                                                                                             
  - Click "Refresh Analytics"                                                                                                                                                    
  - Verify collection comparison and question consistency data                                                                                                                   
                                                                                                                                                                                 
  4. **Test Project analytics:**                                                                                                                                                 
  - Navigate to project analytics page                                                                                                                                           
  - Click "Refresh Analytics"                                                                                                                                                    
  - Verify cross-template themes and strategic insights                                                                                                                          
                                                                                                                                                                                 
  ---                                                                                                                                                                            
                                                                                                                                                                                 
  ## 15. Cost Estimate                                                                                                                                                           
                                                                                                                                                                                 
  With gpt-4o-mini at ~$0.15/1M input tokens and ~$0.60/1M output tokens:                                                                                                        
                                                                                                                                                                                 
  - Persona generation: ~36 calls × ~500 tokens = ~18K tokens                                                                                                                    
  - Conversation generation: ~216 calls × ~2K tokens = ~432K tokens                                                                                                              
  - Summary generation: ~216 calls × ~1K tokens = ~216K tokens                                                                                                                   
                                                                                                                                                                                 
  **Estimated total: ~$0.10-0.20 per full run** 