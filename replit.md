# Alvia - Voice-Based AI Interview Platform

## Overview

Alvia is a voice-based AI interview platform designed for scalable qualitative research. It leverages AI for voice conversations, with Alvia acting as the interviewer and Barbara as the orchestrator providing real-time guidance based on transcripts. The platform includes features such as consent management, PII redaction, cross-interview analysis, hierarchical analytics (Collection, Template, Project), invitation-based respondent recruitment, and strategic context for tailored recommendations. The business vision is to provide a robust tool for researchers to gather and analyze qualitative data efficiently.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Tech Stack
- **Frontend**: React 18, Wouter, TanStack React Query, Radix UI, Tailwind CSS, Framer Motion
- **Backend**: Express.js with WebSocket support
- **Database**: PostgreSQL with Drizzle ORM
- **Auth**: Replit OpenID Connect via Passport
- **Voice**: OpenAI Realtime API (`gpt-realtime-mini`) or xAI Grok (`grok-3-fast`)
- **Orchestration**: Barbara (8 configurable use cases)
- **Infographics**: Google Gemini API
- **PDF Export**: jsPDF
- **Testing**: Vitest
- **Build**: Vite (client) + esbuild (server), TypeScript

### Key Patterns
- **Path aliases**: `@/*` for client, `@shared/*` for shared code.
- **Data hierarchy**: Workspace → Project → InterviewTemplate → Collection → InterviewSession → Segment.
- **Data integrity**: Ownership verification for all hierarchies and authenticated endpoints.
- **Database operations**: Centralized through `DatabaseStorage` class, implementing `IStorage` interface, with schema generating types via `drizzle-zod`.
- **API validation**: Zod schemas for shared client-side form validation and server-side input validation.

### UI/UX Decisions
- Typography: Inter for UI, JetBrains Mono for technical data.
- Spacing: Tailwind units (2, 4, 6, 8, 12, 16).
- Icons: Lucide React.
- Components follow shadcn/ui conventions with Radix primitives.
- Dark/light theme support.

### Core Features
- **Voice Interview Flow**: Respondents join via unique links, opening a WebSocket connection for real-time audio. The server bridges audio between the client and the voice provider. Barbara provides guidance based on transcripts, and transcription quality is monitored. Responses are saved as `Segments`. Additional questions can be generated by Barbara. Session summaries are generated on completion. State is persisted for crash recovery.
- **Barbara Orchestrator**: Configurable AI analysis and guidance system with eight use cases (e.g., analysis, summarisation, template generation, additional questions). Each use case has configurable model, verbosity, and reasoning effort. All LLM calls are tracked.
- **LLM Usage Tracking**: Billing-grade token tracking with event logs and hourly rollups.
- **Transcription Quality**: Real-time noisy environment detection and VAD tuning.
- **Analytics**: Hierarchical analytics across collections, templates, and projects.
- **PII Redaction**: Pseudonymization of personally identifiable information.

### Database Schema Highlights
- **Core tables**: `workspaces`, `projects`, `interviewTemplates`, `questions`, `collections`, `respondents`, `interviewSessions`, `segments`, `redactionMaps`, `llmUsageEvents`, `llmUsageRollups`, `inviteList`, `waitlistEntries`.
- **Enums**: `questionTypeEnum`, `sessionStatusEnum`, `userRoleEnum`, `contextTypeEnum`, `respondentStatusEnum`, `llmProviderEnum`, `llmUsageStatusEnum`.
- **Session JSONB fields**: `liveTranscript`, `lastBarbaraGuidance`, `questionStates`, `questionSummaries`, `additionalQuestions`, `alviaSummary`, `barbaraSessionSummary`, `transcriptionQualityMetrics`, `performanceMetrics`.

## External Dependencies

- **OpenAI**: Realtime API for voice conversations and `gpt-realtime-mini` for Alvia's voice.
- **xAI Grok**: `grok-3-fast` as an alternative voice provider.
- **Google Gemini API**: For AI-generated visual summaries (infographics).
- **PostgreSQL**: Primary database.
- **Replit OpenID Connect**: For user authentication.
- **Vite**: Frontend build tool.
- **esbuild**: Backend build tool.
- **jsPDF**: For PDF report generation.
- **Radix UI**: UI component primitives.
- **Tailwind CSS**: Utility-first CSS framework.
- **Framer Motion**: Animation library.
- **Vitest**: Server-side unit testing framework.