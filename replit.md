# Alvia - Voice-Based AI Interview Platform

## Overview

Alvia is a voice-based AI interview platform designed for scalable qualitative research. It utilizes OpenAI's GPT-4o Real-time API for natural voice conversations, automating transcription and analysis of responses. Key features include consent management, PII redaction, sophisticated cross-interview analysis, and an advanced analytics system that delivers insights at Collection, Template, and Project levels. The platform also provides an invitation system for respondent recruitment and a strategic context feature to offer tailored analytics recommendations. Alvia aims to enhance qualitative research efficiency and insight generation through AI.

## User Preferences

Preferred communication style: Simple, everyday language.

## System Architecture

### Tech Stack
-   **Frontend**: React 18 (TypeScript, Wouter, TanStack React Query, Radix UI, Tailwind CSS)
-   **Backend**: Express.js with WebSockets
-   **Database**: PostgreSQL with Drizzle ORM
-   **Authentication**: Replit OpenID Connect via Passport.js
-   **Voice Processing**: OpenAI Realtime GA API (`gpt-realtime-mini`), with multi-provider support (Grok/xAI via `grok-3-fast`)
-   **Infographic Generation**: Gemini API (`gemini-3-pro-image-preview`)

### Design Patterns and Features
-   **Data Model**: Hierarchical structure: Workspace → Project → InterviewTemplate → Collection → InterviewSession → Segment.
-   **Data Management**: Centralized database operations, real-time WebSocket communication, Zod for form validation, REST API with authentication middleware.
-   **AI Guidance**: Lag-by-one-turn guidance and a hybrid Barbara Prompt Strategy optimize AI response generation by focusing on recent transcript segments.
-   **Analytics**: Multi-level analytics system (Collection, Template, Project) with AI-powered cross-template synthesis and strategic context integration for tailored recommendations.
-   **User Experience**: shadcn/ui component library, comprehensive session detail pages, project-level infographics, and PDF export for analytics.
-   **Data Integrity and Security**: Data isolation enforces ownership verification across all hierarchies (User → Workspace → Project → Template → Collection → Session).
-   **Interview Management**: Respondent invitation system with tracking, automatic cleanup of abandoned sessions, and AI-powered generation of interview templates from project metadata.
-   **Advanced AI Features**:
    -   **Multi-Provider Realtime Voice Support**: Abstracted `RealtimeProvider` interface for switching between OpenAI and Grok APIs, configurable per collection.
    -   **Additional Questions**: AI-powered follow-up questions generated by Barbara, configurable per collection.
    -   **Silent Ambient Calibration**: Automatic microphone calibration for dynamic silence detection.
    -   **Enhanced Transcription Quality Handling**: Adaptive mechanisms to address foreign language hallucinations and transcription issues.
    -   **Dynamic VAD Eagerness Adjustment**: Mid-session adjustment of OpenAI's semantic VAD eagerness based on utterance patterns.
    -   **Dual-Perspective End-of-Interview Summary**: Generates two independent session summaries (Alvia's audio-informed and Barbara's analytical) upon interview completion.
    -   **Cross-Interview Context Injection**: Provides Barbara with theme context and question quality insights from prior interviews to enhance live steering.
    -   **Analytics-Guided Hypothesis Testing**: Feeds project-level analytics recommendations into live interviews as testable hypotheses for Barbara.
-   **Platform Features**: Demo project auto-seeding for new users, invite-only waitlist system.
-   **Robustness**: Automatic WebSocket reconnection with exponential backoff and UI indicators.
-   **LLM Usage Tracking**: Dual-write pattern for atomic tracking and aggregated rollups of LLM token usage.
-   **Phase-Aware Prompt Lifecycle**: Alvia's instructions adapt based on conversational phase to ensure natural flow and context.

## External Dependencies

-   **PostgreSQL Database**: Primary data storage.
-   **OpenAI API**: For GPT-4o Real-time voice interviews, GPT-based interview guidance, and analytics processing.
-   **Gemini API**: Used for infographic generation.
-   **Replit Authentication**: Utilized for user authentication via OpenID Connect.
-   **xAI Grok API**: Alternative real-time voice processing provider.